2023-12-08 10:54:05,256 - jsi-cli-logger - INFO - 

################################################################################
                               [ JSI CLI STARTS ]                               
################################################################################

2023-12-08 10:54:05,256 - jsi-cli-logger - INFO - sys.argv: ['/var/db/scripts/op/jsi', '--user', 'login']
2023-12-08 10:54:05,256 - jsi-cli-logger - INFO - 

********************************************************************************
                               USER LOGIN COMMAND                               
********************************************************************************

2023-12-08 10:54:05,258 - jsi-cli-logger - INFO - Default user login session check flag is on, let's check if there is an active user session...
2023-12-08 10:54:05,258 - jsi-cli-logger - DEBUG - call "user_self" function...
2023-12-08 10:54:05,258 - jsi-cli-logger - DEBUG - call "get_csrftoken" function...
2023-12-08 10:54:05,637 - jsi-cli-logger - DEBUG - 


============ BEGIN ============

<<<<<<<<<<<< Send
    Request URL: "https://api.eu.mist.com/api/v1/self"
    Request Method: GET
    Request Headers:
        {
            "User-Agent": "python-requests/2.28.1",
            "Accept-Encoding": "gzip, deflate",
            "Accept": "*/*",
            "Connection": "keep-alive",
            "Content-Type": "application/json",
            "X-Csrftoken": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "Cookie": "csrftoken.eu=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; sessionid.eu=ux6lk13uu8rjehf0r4t6mp52zm5unm2f"
        }
    Request Payload:
        None

>>>>>>>>>>>> Receive
    Response URL: "https://api.eu.mist.com/api/v1/self"
    Response Status Code: 401
    Response Headers:
        {
            "Date": "Fri, 08 Dec 2023 15:55:46 GMT",
            "Content-Type": "application/json",
            "Content-Length": "58",
            "Connection": "keep-alive",
            "WWW-Authenticate": "Custom realm=\"mist\"",
            "Vary": "Accept, Cookie, Origin",
            "Allow": "DELETE, GET, OPTIONS, PUT",
            "X-Frame-Options": "DENY",
            "Cache-Control": "no-cache, no-store",
            "Pragma": "no-cache",
            "Set-Cookie": "sessionid.eu=\"\"; Domain=.eu.mist.com; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0; Path=/; SameSite=Lax",
            "Access-Control-Allow-Credentials": "true",
            "Access-Control-Expose-Headers": "X-Auth-Token,X-CSRFToken,X-Requested-With,X-Page-Limit,X-Page-Page,X-Page-Total",
            "Content-Security-Policy": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';",
            "X-Content-Type-Options": "nosniff",
            "X-Xss-Protection": "1; mode=block",
            "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload",
            "Referrer-Policy": "strict-origin-when-cross-origin",
            "Permissions-Policy": "geolocation=()",
            "X-Kong-Upstream-Latency": "11",
            "X-Kong-Proxy-Latency": "0",
            "Via": "kong/2.1.4"
        }
    Response Payloads:
        {
            "detail": "Authentication credentials were not provided."
        }

============ END ==============

2023-12-08 10:54:05,637 - jsi-cli-logger - INFO - checking if user is already logged in...?
2023-12-08 10:54:05,638 - jsi-cli-logger - DEBUG - call "user_self" function...
2023-12-08 10:54:05,638 - jsi-cli-logger - DEBUG - call "get_csrftoken" function...
2023-12-08 10:54:05,978 - jsi-cli-logger - DEBUG - 


============ BEGIN ============

<<<<<<<<<<<< Send
    Request URL: "https://api.eu.mist.com/api/v1/self"
    Request Method: GET
    Request Headers:
        {
            "User-Agent": "python-requests/2.28.1",
            "Accept-Encoding": "gzip, deflate",
            "Accept": "*/*",
            "Connection": "keep-alive",
            "Content-Type": "application/json",
            "X-Csrftoken": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "Cookie": "csrftoken.eu=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; sessionid.eu=ux6lk13uu8rjehf0r4t6mp52zm5unm2f"
        }
    Request Payload:
        None

>>>>>>>>>>>> Receive
    Response URL: "https://api.eu.mist.com/api/v1/self"
    Response Status Code: 401
    Response Headers:
        {
            "Date": "Fri, 08 Dec 2023 15:55:46 GMT",
            "Content-Type": "application/json",
            "Content-Length": "58",
            "Connection": "keep-alive",
            "WWW-Authenticate": "Custom realm=\"mist\"",
            "Vary": "Accept, Cookie, Origin",
            "Allow": "GET, OPTIONS, DELETE, PUT",
            "X-Frame-Options": "DENY",
            "Cache-Control": "no-cache, no-store",
            "Pragma": "no-cache",
            "Set-Cookie": "sessionid.eu=\"\"; Domain=.eu.mist.com; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0; Path=/; SameSite=Lax",
            "Access-Control-Allow-Credentials": "true",
            "Access-Control-Expose-Headers": "X-Auth-Token,X-CSRFToken,X-Requested-With,X-Page-Limit,X-Page-Page,X-Page-Total",
            "Content-Security-Policy": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';",
            "X-Content-Type-Options": "nosniff",
            "X-Xss-Protection": "1; mode=block",
            "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload",
            "Referrer-Policy": "strict-origin-when-cross-origin",
            "Permissions-Policy": "geolocation=()",
            "X-Kong-Upstream-Latency": "10",
            "X-Kong-Proxy-Latency": "0",
            "Via": "kong/2.1.4"
        }
    Response Payloads:
        {
            "detail": "Authentication credentials were not provided."
        }

============ END ==============

2023-12-08 10:54:05,978 - jsi-cli-logger - INFO - No user is currently logged in. proceed with manual login
2023-12-08 10:54:05,978 - jsi-cli-logger - INFO - input username
2023-12-08 10:54:05,979 - jsi-cli-logger - INFO - To connect your device to the JSI service, log in with your Mist Cloud ID. If you don't have one? head over to https://manage.mist.com
2023-12-08 10:54:10,578 - jsi-cli-logger - INFO - Calling user lookup function to check if username is registered and available
2023-12-08 10:54:10,578 - jsi-cli-logger - DEBUG - call "user_lookup" function...
2023-12-08 10:54:10,578 - jsi-cli-logger - DEBUG - call "get_csrftoken" function...
2023-12-08 10:54:12,441 - jsi-cli-logger - DEBUG - 


============ BEGIN ============

<<<<<<<<<<<< Send
    Request URL: "https://api.mist.com/api/v1/sso/lookup"
    Request Method: POST
    Request Headers:
        {
            "User-Agent": "python-requests/2.28.1",
            "Accept-Encoding": "gzip, deflate",
            "Accept": "*/*",
            "Connection": "keep-alive",
            "Content-Type": "application/json",
            "X-Csrftoken": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "Content-Length": "29"
        }
    Request Payload:
        {
            "email": "srho@juniper.net"
        }

>>>>>>>>>>>> Receive
    Response URL: "https://api.mist.com/api/v1/sso/lookup"
    Response Status Code: 200
    Response Headers:
        {
            "Date": "Fri, 08 Dec 2023 15:55:53 GMT",
            "Content-Type": "application/json",
            "Content-Length": "91",
            "Connection": "keep-alive",
            "Vary": "Accept, Cookie, Origin",
            "Allow": "POST, OPTIONS",
            "X-Frame-Options": "DENY",
            "Cache-Control": "no-cache, no-store",
            "Pragma": "no-cache",
            "Access-Control-Allow-Credentials": "true",
            "Access-Control-Expose-Headers": "X-Auth-Token,X-CSRFToken,X-Page-Limit,X-Page-Page,X-Page-Total,X-Requested-With",
            "Content-Security-Policy": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';",
            "X-Content-Type-Options": "nosniff",
            "X-Xss-Protection": "1; mode=block",
            "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload",
            "Referrer-Policy": "strict-origin-when-cross-origin",
            "Permissions-Policy": "geolocation=()",
            "X-Kong-Upstream-Latency": "1560",
            "X-Kong-Proxy-Latency": "0",
            "Via": "kong/2.1.4"
        }
    Response Payloads:
        {
            "email": "srho@juniper.net",
            "accounts": [
                {
                    "api_url": "https://api.mist.com",
                    "type": "local"
                }
            ]
        }

============ END ==============

2023-12-08 10:54:12,441 - jsi-cli-logger - INFO - username found! and ask for password
2023-12-08 10:54:15,312 - jsi-cli-logger - INFO - Call user login function using username(email format) and password
2023-12-08 10:54:15,313 - jsi-cli-logger - DEBUG - call "user_login" function...
2023-12-08 10:54:15,313 - jsi-cli-logger - DEBUG - call "get_csrftoken" function...
2023-12-08 10:54:15,894 - jsi-cli-logger - DEBUG - 


============ BEGIN ============

<<<<<<<<<<<< Send
    Request URL: "https://api.mist.com/api/v1/login"
    Request Method: POST
    Request Headers:
        {
            "User-Agent": "python-requests/2.28.1",
            "Accept-Encoding": "gzip, deflate",
            "Accept": "*/*",
            "Connection": "keep-alive",
            "Content-Type": "application/json",
            "X-Csrftoken": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "Content-Length": "55"
        }
    Request Payload:
        {
            "email": "srho@juniper.net",
            "password": "xxxxxxxxxx"
        }

>>>>>>>>>>>> Receive
    Response URL: "https://api.mist.com/api/v1/login"
    Response Status Code: 200
    Response Headers:
        {
            "Date": "Fri, 08 Dec 2023 15:55:56 GMT",
            "Content-Type": "application/json",
            "Content-Length": "2",
            "Connection": "keep-alive",
            "Vary": "Accept, Cookie, Origin",
            "Allow": "OPTIONS, POST",
            "X-Frame-Options": "DENY",
            "Cache-Control": "no-cache, no-store",
            "Pragma": "no-cache",
            "Set-Cookie": "csrftoken=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; Domain=.mist.com; expires=Fri, 06 Dec 2024 15:55:56 GMT; Max-Age=31449600; Path=/; SameSite=Lax; Secure, sessionid=aafl7t1n4fhhxzq1xqd0ns4au9vlm0ge; Domain=.mist.com; expires=Fri, 22 Dec 2023 15:55:56 GMT; HttpOnly; Max-Age=1209600; Path=/; SameSite=Lax; Secure",
            "Access-Control-Allow-Credentials": "true",
            "Access-Control-Expose-Headers": "X-Auth-Token,X-CSRFToken,X-Page-Limit,X-Page-Page,X-Page-Total,X-Requested-With",
            "Content-Security-Policy": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';",
            "X-Content-Type-Options": "nosniff",
            "X-Xss-Protection": "1; mode=block",
            "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload",
            "Referrer-Policy": "strict-origin-when-cross-origin",
            "Permissions-Policy": "geolocation=()",
            "X-Kong-Upstream-Latency": "307",
            "X-Kong-Proxy-Latency": "0",
            "Via": "kong/2.1.4"
        }
    Response Payloads:
        {}

============ END ==============

2023-12-08 10:54:15,895 - jsi-cli-logger - INFO - login successful! But check if two-factor authentication is required
2023-12-08 10:54:15,895 - jsi-cli-logger - INFO - Checking if two-factor authentication is required???
2023-12-08 10:54:15,895 - jsi-cli-logger - DEBUG - call "user_self" function...
2023-12-08 10:54:15,895 - jsi-cli-logger - DEBUG - call "get_csrftoken" function...
2023-12-08 10:54:16,208 - jsi-cli-logger - DEBUG - 


============ BEGIN ============

<<<<<<<<<<<< Send
    Request URL: "https://api.mist.com/api/v1/self"
    Request Method: GET
    Request Headers:
        {
            "User-Agent": "python-requests/2.28.1",
            "Accept-Encoding": "gzip, deflate",
            "Accept": "*/*",
            "Connection": "keep-alive",
            "Content-Type": "application/json",
            "X-Csrftoken": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "Cookie": "csrftoken=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; sessionid=aafl7t1n4fhhxzq1xqd0ns4au9vlm0ge"
        }
    Request Payload:
        None

>>>>>>>>>>>> Receive
    Response URL: "https://api.mist.com/api/v1/self"
    Response Status Code: 200
    Response Headers:
        {
            "Date": "Fri, 08 Dec 2023 15:55:57 GMT",
            "Content-Type": "application/json",
            "Content-Length": "81",
            "Connection": "keep-alive",
            "Vary": "Accept, Cookie, Origin",
            "Allow": "GET, OPTIONS, DELETE, PUT",
            "X-Frame-Options": "DENY",
            "Cache-Control": "no-cache, no-store",
            "Pragma": "no-cache",
            "Set-Cookie": "sessionid=aafl7t1n4fhhxzq1xqd0ns4au9vlm0ge; Domain=.mist.com; expires=Sat, 09 Dec 2023 15:55:57 GMT; HttpOnly; Max-Age=86400; Path=/; SameSite=Lax; Secure",
            "Access-Control-Allow-Credentials": "true",
            "Access-Control-Expose-Headers": "X-Auth-Token,X-CSRFToken,X-Page-Limit,X-Page-Page,X-Page-Total,X-Requested-With",
            "Content-Security-Policy": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';",
            "X-Content-Type-Options": "nosniff",
            "X-Xss-Protection": "1; mode=block",
            "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload",
            "Referrer-Policy": "strict-origin-when-cross-origin",
            "Permissions-Policy": "geolocation=()",
            "X-Kong-Upstream-Latency": "40",
            "X-Kong-Proxy-Latency": "0",
            "Via": "kong/2.1.4"
        }
    Response Payloads:
        {
            "email": "srho@juniper.net",
            "two_factor_required": true,
            "two_factor_passed": false
        }

============ END ==============

2023-12-08 10:54:16,208 - jsi-cli-logger - INFO - Ok, two-factor authentication required and get the two-factor authentication code
2023-12-08 10:54:16,209 - jsi-cli-logger - INFO - Ask a user to enter the two-factor authentication code
2023-12-08 10:54:28,028 - jsi-cli-logger - INFO - two-factor authentication code: 544247
2023-12-08 10:54:28,028 - jsi-cli-logger - INFO - Submit a two-factor authentication code to the server
2023-12-08 10:54:28,028 - jsi-cli-logger - DEBUG - call "user_two_factor_auth" function...
2023-12-08 10:54:28,029 - jsi-cli-logger - DEBUG - call "get_csrftoken" function...
2023-12-08 10:54:28,327 - jsi-cli-logger - DEBUG - 


============ BEGIN ============

<<<<<<<<<<<< Send
    Request URL: "https://api.mist.com/api/v1/login/two_factor"
    Request Method: POST
    Request Headers:
        {
            "User-Agent": "python-requests/2.28.1",
            "Accept-Encoding": "gzip, deflate",
            "Accept": "*/*",
            "Connection": "keep-alive",
            "Content-Type": "application/json",
            "X-Csrftoken": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "Cookie": "csrftoken=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; sessionid=aafl7t1n4fhhxzq1xqd0ns4au9vlm0ge",
            "Content-Length": "24"
        }
    Request Payload:
        {
            "two_factor": "544247"
        }

>>>>>>>>>>>> Receive
    Response URL: "https://api.mist.com/api/v1/login/two_factor"
    Response Status Code: 200
    Response Headers:
        {
            "Date": "Fri, 08 Dec 2023 15:56:09 GMT",
            "Content-Type": "application/json",
            "Content-Length": "2",
            "Connection": "keep-alive",
            "Vary": "Accept, Cookie, Origin",
            "Allow": "POST, OPTIONS",
            "X-Frame-Options": "DENY",
            "Cache-Control": "no-cache, no-store",
            "Pragma": "no-cache",
            "Set-Cookie": "sessionid=aafl7t1n4fhhxzq1xqd0ns4au9vlm0ge; Domain=.mist.com; expires=Sat, 09 Dec 2023 15:56:09 GMT; HttpOnly; Max-Age=86400; Path=/; SameSite=Lax; Secure",
            "Access-Control-Allow-Credentials": "true",
            "Access-Control-Expose-Headers": "X-Auth-Token,X-CSRFToken,X-Page-Limit,X-Page-Page,X-Page-Total,X-Requested-With",
            "Content-Security-Policy": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';",
            "X-Content-Type-Options": "nosniff",
            "X-Xss-Protection": "1; mode=block",
            "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload",
            "Referrer-Policy": "strict-origin-when-cross-origin",
            "Permissions-Policy": "geolocation=()",
            "X-Kong-Upstream-Latency": "17",
            "X-Kong-Proxy-Latency": "1",
            "Via": "kong/2.1.4"
        }
    Response Payloads:
        {}

============ END ==============

2023-12-08 10:54:28,328 - jsi-cli-logger - INFO - two-factor authentication passed! Let's check if user privileges info is available?
2023-12-08 10:54:28,328 - jsi-cli-logger - DEBUG - call "user_self" function...
2023-12-08 10:54:28,328 - jsi-cli-logger - DEBUG - call "get_csrftoken" function...
2023-12-08 10:54:28,619 - jsi-cli-logger - DEBUG - 


============ BEGIN ============

<<<<<<<<<<<< Send
    Request URL: "https://api.mist.com/api/v1/self"
    Request Method: GET
    Request Headers:
        {
            "User-Agent": "python-requests/2.28.1",
            "Accept-Encoding": "gzip, deflate",
            "Accept": "*/*",
            "Connection": "keep-alive",
            "Content-Type": "application/json",
            "X-Csrftoken": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "Cookie": "csrftoken=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; sessionid=aafl7t1n4fhhxzq1xqd0ns4au9vlm0ge"
        }
    Request Payload:
        None

>>>>>>>>>>>> Receive
    Response URL: "https://api.mist.com/api/v1/self"
    Response Status Code: 200
    Response Headers:
        {
            "Date": "Fri, 08 Dec 2023 15:56:09 GMT",
            "Content-Type": "application/json",
            "Content-Length": "356",
            "Connection": "keep-alive",
            "Vary": "Accept, Cookie, Origin",
            "Allow": "OPTIONS, GET, DELETE, PUT",
            "X-Frame-Options": "DENY",
            "Cache-Control": "no-cache, no-store",
            "Pragma": "no-cache",
            "Access-Control-Allow-Credentials": "true",
            "Access-Control-Expose-Headers": "X-Auth-Token,X-CSRFToken,X-Page-Limit,X-Page-Page,X-Page-Total,X-Requested-With",
            "Content-Security-Policy": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';",
            "X-Content-Type-Options": "nosniff",
            "X-Xss-Protection": "1; mode=block",
            "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload",
            "Referrer-Policy": "strict-origin-when-cross-origin",
            "Permissions-Policy": "geolocation=()",
            "X-Kong-Upstream-Latency": "22",
            "X-Kong-Proxy-Latency": "0",
            "Via": "kong/2.1.4"
        }
    Response Payloads:
        {
            "email": "srho@juniper.net",
            "first_name": "Simon",
            "last_name": "Rho",
            "enable_two_factor": true,
            "two_factor_verified": true,
            "phone": "97879916721",
            "phone2": "123-456-6789",
            "tags": [
                "has_8021x",
                "mist",
                "wired",
                "mist-customer"
            ],
            "session_expiry": 1440,
            "privileges": [
                {
                    "scope": "org",
                    "org_id": "d493e95f-07ad-4163-85f0-5285cf26be94",
                    "role": "admin",
                    "name": "Juniper-test1"
                }
            ]
        }

============ END ==============

2023-12-08 10:54:28,620 - jsi-cli-logger - INFO - Good! - user session is active and privileges info is available.
2023-12-08 10:54:28,620 - jsi-cli-logger - INFO - 


srho@juniper.net login successfully

2023-12-08 10:54:28,620 - jsi-cli-logger - INFO - 

                                                                                
                               Bye! JSI CLI ends.                               
                                                                                
